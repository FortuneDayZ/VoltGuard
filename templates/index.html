<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VoltGuard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #0d95b9;
      --accent: #fbc648;
      --glass-bg: rgba(255, 255, 255, 0.8);
      --glass-border: rgba(255, 255, 255, 0.3);
    }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(145deg, #e6f1f8, #f9f9f9);
      color: #333;
    }
    header {
      background: linear-gradient(90deg, var(--primary), #12b8c8);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    nav a {
      margin-left: 1.5rem;
      color: white;
      text-decoration: none;
      font-weight: 600;
      position: relative;
    }
    nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 100%;
      height: 2px;
      background-color: white;
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    nav a:hover::after {
      transform: scaleX(1);
    }
    .container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2.5rem;
      padding: 2.5rem;
    }
    .section {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 1.5rem 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      margin-bottom: 2.5rem;
    }
    h2 {
      margin-top: 0;
      font-size: 1.3rem;
      color: var(--primary);
      border-left: 4px solid var(--accent);
      padding-left: 0.5rem;
    }
    input, select, button {
      margin-top: 0.5rem;
      padding: 0.6rem;
      width: 100%;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }
    
    select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 0.6rem 2.5rem 0.6rem 0.75rem;
  font-size: 0.95rem;
  font-family: 'Inter', sans-serif;
  position: relative;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg fill='%230D95B9' viewBox='0 0 20 20'%3E%3Cpath d='M7 7l3 3 3-3'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 1.25rem;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(13, 149, 185, 0.2);
  outline: none;
}

select:hover {
  border-color: var(--primary);
  cursor: pointer;
}


    button {
      background-color: var(--primary);
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #0b7fa1;
    }
    .device-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.95rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 10px;
      overflow: hidden;
    }
    .device-table thead {
      background-color: var(--primary);
      color: white;
    }
    .device-table th, .device-table td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .device-table tr:nth-child(even) {
      background-color: #f4f9fc;
    }
    .device-table tr:hover {
      background-color: #eaf6fa;
    }
    .remove-btn {
      background-color: #f45c5c;
      border: none;
      padding: 0.4rem 0.8rem;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .remove-btn:hover {
      background-color: #d84343;
    }
    .total-cost {
      text-align: right;
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 1.5rem;
      color: #333;
    }
    #categoryChart {
      max-width: 260px;
      max-height: 260px;
      margin: 0 auto;
      display: block;
      background: white;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      padding: 1rem;
    }
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>VoltGuard</h1>
    <nav>
      <a href="#">Login</a>
      <a href="#">Map</a>
      <a href="#">Advice</a>
    </nav>
  </header>
  <div class="container">
    <!-- LEFT COLUMN -->
    <div>
<div class="section">
  <h2>Select Electricity Rate</h2>
  <label for="rateSelect">Choose Electricity Rate ($/kWh)</label>
  <select id="rateSelect">
    <option value="">-- Select a Standard Rate --</option>
    <option value="0.27">California - $0.27</option>
    <option value="0.12">Texas - $0.12</option>
    <option value="0.13">U.S. Average - $0.13</option>
  </select>
  <input type="number" id="rateInput" step="0.01" placeholder="Or enter your rate ($/kWh)" />
</div>

      <div class="section">
        <h2>Add Device Usage</h2>
        <input type="text" id="nameInput" placeholder="Device Name" />
        <input type="number" id="wattsInput" placeholder="Watts Used" />
        <input type="number" id="hoursInput" placeholder="Hours per Day" />
        <select id="categorySelect">
          <option value="">Select Category</option>
          <option>Appliances</option>
          <option>Personal Electronics</option>
          <option>Heating & Cooling</option>
          <option>Lighting</option>
          <option>Kitchen & Cooking</option>
          <option>Outdoor / Utility</option>
          <option>Miscellaneous</option>
        </select>
        <button id="addButton">Add Appliance</button>
      </div>

      <div class="section">
        <h2>Devices You've Added</h2>
        <table class="device-table">
<thead>
  <tr>
    <th>Appliance</th>
    <th>Category</th>
    <th>Runtime</th>
    <th>Watts</th>
    <th>kWh/day</th>
    <th>Cost</th>
    <th>Actions</th>
  </tr>
</thead>

          <tbody id="deviceBody"></tbody>
        </table>
        <div class="total-cost">
          <strong>Total Daily Cost:</strong> <span id="totalCost">$0.00</span>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div>
      <div class="section">
        <h2>Map (Placeholder)</h2>
        <div class="graph">[Google Map Placeholder]</div>
      </div>

      <div class="section">
        <h2>Electricity Cost by Category</h2>
        <canvas id="categoryChart"></canvas>
      </div>

      <div class="section">
        <h2>Ask VoltBot</h2>
        <div style="height: 200px; background-color: #fff8e1; border: 2px dashed var(--accent); padding: 1rem; border-radius: 8px; overflow-y: auto;">
          <p><strong>You:</strong> How can I reduce my electricity bill?</p>
          <p><strong>VoltBot:</strong> Try using energy-efficient appliances and turning off unused devices.</p>
        </div>
        <input type="text" placeholder="Ask a question..." />
      </div>
    </div>
  </div>

  <script>
    const deviceList = [];
    const rateSelect = document.getElementById('rateSelect');
    const rateInput = document.getElementById('rateInput');
    const nameInput = document.getElementById('nameInput');
    const wattsInput = document.getElementById('wattsInput');
    const hoursInput = document.getElementById('hoursInput');
    const categoryInput = document.getElementById('categorySelect');
    const addButton = document.getElementById('addButton');
    const tbody = document.getElementById('deviceBody');
    const totalCostDisplay = document.getElementById('totalCost');
    let chart;

    const predefinedDevices = {
      'Laptop': { watts: 50, hours: 3 },
      'Fridge': { watts: 150, hours: 24 },
      'Microwave': { watts: 1000, hours: 1 }
    };

    nameInput.addEventListener('input', () => {
      const val = nameInput.value.trim();
      if (predefinedDevices[val]) {
        wattsInput.value = predefinedDevices[val].watts;
        hoursInput.value = predefinedDevices[val].hours;
      }
    });

    function showToast(msg) {
      const toast = document.createElement('div');
      toast.textContent = msg;
      toast.style.position = 'fixed';
      toast.style.bottom = '1rem';
      toast.style.right = '1rem';
      toast.style.background = '#0d95b9';
      toast.style.color = 'white';
      toast.style.padding = '0.75rem 1.25rem';
      toast.style.borderRadius = '8px';
      toast.style.boxShadow = '0 4px 10px rgba(0,0,0,0.1)';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function calculateRate() {
      let rateStr = rateSelect.value.split(' - ')[1];
      let rate = rateStr ? parseFloat(rateStr) / 100 : parseFloat(rateInput.value);
      return isNaN(rate) ? 0.1289 : rate;
    }

    function recalculateTotal() {
      const rate = calculateRate();
      let total = 0;
      deviceList.forEach(device => {
        total += (device.watts * device.hours / 1000) * rate;
      });
      totalCostDisplay.textContent = `$${total.toFixed(2)}`;
    }

    function renderDevices() {
      tbody.innerHTML = '';
      deviceList.forEach((device, index) => {
        const tr = document.createElement('tr');
tr.innerHTML = `
  <td>${device.name}</td>
  <td>${device.category}</td>
  <td>${device.hours}</td>
  <td>${device.watts}</td>
  <td>${(device.hours * device.watts / 1000).toFixed(2)}</td>
  <td>$${((device.hours * device.watts / 1000) * calculateRate()).toFixed(3)}</td>
  <td>
    <button class="remove-btn" onclick="removeDevice(${index})">Remove</button>
    <button class="remove-btn" style="background-color: #fbc648" onclick="editDevice(${index})">Edit</button>
  </td>`;

        tbody.appendChild(tr);
      });
      recalculateTotal();
      updatePieChart();
    }

    function removeDevice(index) {
      deviceList.splice(index, 1);
      renderDevices();
      showToast('Device removed.');
    }

    function editDevice(index) {
      const device = deviceList[index];
      nameInput.value = device.name;
      wattsInput.value = device.watts;
      hoursInput.value = device.hours;
      categoryInput.value = device.category;
      removeDevice(index);
      showToast('Editing device.');
    }

    addButton.addEventListener('click', () => {
      const name = nameInput.value.trim();
      const watts = parseFloat(wattsInput.value);
      const hours = parseFloat(hoursInput.value);
      const category = categoryInput.value;
      if (!name || isNaN(watts) || isNaN(hours) || !category) {
        showToast('Please complete all fields including category.');
        return;
      }
      deviceList.push({ name, watts, hours, category });
      renderDevices();
      nameInput.value = wattsInput.value = hoursInput.value = '';
      categoryInput.value = '';
      showToast('Device added!');
    });

    rateSelect.addEventListener('change', () => {
      showToast('Rate updated. Recalculating...');
      recalculateTotal();
      updatePieChart();
    });

    rateInput.addEventListener('input', () => {
      showToast('Rate updated. Recalculating...');
      recalculateTotal();
      updatePieChart();
    });

function updatePieChart() {
  const categoryData = {};
  const rate = calculateRate();
  deviceList.forEach(device => {
    const energy = (device.watts * device.hours / 1000) * rate;
    categoryData[device.category] = (categoryData[device.category] || 0) + energy;
  });

  const labels = Object.keys(categoryData);
  const data = Object.values(categoryData);
  const total = data.reduce((a, b) => a + b, 0);

  const colors = ['#6EB7C9', '#FBC648', '#CB2C3C', '#C3E6CB', '#E6C3F1', '#FFD6A5', '#0D95B9'];

  if (chart) chart.destroy();
  const ctx = document.getElementById('categoryChart').getContext('2d');

  chart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: colors,
        borderColor: '#fff',
        borderWidth: 2,
        borderRadius: 12,
        hoverOffset: 8
      }]
    },
    options: {
      responsive: true,
      cutout: '65%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,
            font: {
              size: 14,
              weight: '600'
            },
            color: '#333'
          }
        },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.label}: $${ctx.raw.toFixed(2)}`
          },
          backgroundColor: '#fff',
          titleColor: '#333',
          bodyColor: '#333',
          borderColor: '#ccc',
          borderWidth: 1
        }
      }
    },
    plugins: [{
      id: 'centerText',
      beforeDraw(chart) {
        const { width, height, ctx } = chart;
        ctx.restore();
        const fontSize = (height / 140).toFixed(2);
        ctx.font = `bold ${fontSize}em Inter`;
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#333';

        const text = `$${total.toFixed(2)}`;
        const textX = Math.round((width - ctx.measureText(text).width) / 2);
        const textY = height / 2 - 25;
        ctx.fillText(text, textX, textY);

        ctx.font = `14px Inter`;
        const subtext = "Total";
        const subX = Math.round((width - ctx.measureText(subtext).width) / 2);
        ctx.fillStyle = '#666';
        ctx.fillText(subtext, subX, textY + 20);
        ctx.save();
      }
    }]
  });
}

  </script>
  
  <!-- Your existing script block -->
<script>
  // ... all your existing code like deviceList[], chart setup, etc ...
</script>

<!-- ðŸ§  VoltBot chat logic -->
<script>
async function askVoltBot() {
  const responseBox = document.querySelector('.section:last-child div');
  const input = document.querySelector('.section:last-child input');
  const question = input.value.trim();
  if (!question && deviceList.length === 0) return;

  responseBox.innerHTML += `<p><strong>You:</strong> ${question || 'Analyze my usage.'}</p>`;

  const res = await fetch('/get-advice', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ devices: deviceList })
  });

  const data = await res.json();
  responseBox.innerHTML += `<p><strong>VoltBot:</strong> ${data.message}</p>`;
  input.value = '';
}

document.querySelector('.section:last-child input').addEventListener('keydown', e => {
  if (e.key === 'Enter') askVoltBot();
});
</script>

  

</body>
</html>
